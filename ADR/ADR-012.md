# ADR-012 â€” Use slog-based structured logging via internal/log

## Status
Accepted

## Context
Earlier phases used basic logging (e.g., `log.Printf`) or minimal logging patterns.  
As the service becomes more structured and is prepared for more advanced features, we need:

- consistent structured logs,
- a single logging abstraction,
- the ability to switch between human-readable and machine-readable formats,
- an easy way to attach metadata (e.g., request_id, duration, status).

The Go standard library introduced `log/slog` as a structured logging API, which is a natural fit for modern services.

## Decision
Introduce an internal logging package:

- `internal/log` with:

    - a global `Logger *slog.Logger`,
    - `Init(env string)` to initialize the logger.

Behavior:

- In `prod` (APP_ENV=prod): use JSON handler (machine-friendly).
- In other environments: use text handler (developer-friendly).

The `cmd/api/main.go` initializes the logger once at startup with:

- `log.Init(cfg.Env)`

HTTP middleware (`GinMiddleware`) then uses this logger to:

- log request start,
- log request end (status, duration, request_id),
- log any relevant information with structured fields.

## Consequences

### Positive
- Structured logs with key/value pairs (e.g., `method`, `path`, `req_id`, `status`, `duration_ms`).
- Easier integration with log aggregation and observability tools in the future.
- Central logging configuration rather than scattered `log.Printf` calls.
- Aligns with idiomatic, modern Go logging (`log/slog`).

### Negative
- Requires basic familiarity with `slog` for contributors.
- Global logger is a pragmatic approach; in Phase 3, we may consider passing loggers or using context for even finer control.

## Alternatives

1. Continue using the standard `log` package with plain text  
   Rejected: unstructured logs are harder to search and analyze, especially as the service grows.

2. Adopt a third-party logging library (zap, zerolog, logrus, etc.)  
   Rejected for now: `log/slog` is part of the standard library, sufficient for our needs, and reduces external dependencies.