# ADR-003 — Extract PDF analysis into a dedicated component

## Status

Accepted

## Context

In Phase 1, the HTTP handler:

- saved the uploaded file to disk,
- called the PDF library directly (`pdf.ToText`),
- performed word counting,
- assembled the JSON response.

This approach tightly coupled the endpoint logic to:

- the PDF library,
- the file system,
- the word counting algorithm.

We want to:

- reuse PDF analysis logic from other endpoints in the future,
- make the parsing logic testable without starting an HTTP server,
- later swap or extend the PDF library usage if needed.

## Decision

We will create a **dedicated PDF analyzer component** under `internal/pdfanalyzer` that:

- exposes simple functions or a small struct API (e.g. `Analyze(path string) (AnalysisResult, error)`),
- encapsulates:
  - calling the PDF library,
  - extracting text,
  - counting words (initially),
- hides internal details (e.g. how we call `pdf.ToText`) from the HTTP layer.

The HTTP handler will then:

- handle the HTTP request and response,
- manage file upload and temporary storage,
- delegate the PDF parsing and word counting to the analyzer component.

## Consequences

### Positive

- HTTP logic and analysis logic are separated.
- Easier to unit test the analysis without dealing with HTTP or form uploads.
- Future changes in PDF handling (e.g. page-level analysis, keyword detection) can be made in one place.
- Prepares a natural “domain/service” layer for Phase 3.

### Negative

- Slight increase in indirection (developers must look into `internal/pdfanalyzer` for parsing details).
- We still keep tight coupling with the file system in this phase (temporary files), which will need refactoring later.

## Alternatives considered

1. **Keep PDF logic inside the HTTP handler**  
   - Rejected: it makes the handler too complex and blocks reuse.

2. **Introduce interfaces and multiple implementations immediately**  
   - Rejected for this phase: we do not yet have enough different use cases to justify a more complex abstraction.

---
