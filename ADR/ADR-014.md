# ADR-014 — Introduce the Application Layer and Use Cases

## Status
Accepted

## Context
Handlers were directly calling the PDF analyzer. This made the system tightly coupled to the PDF library and prevented:

- mocking,
- testing business flows,
- separating concerns,
- adding new rules or logic around analysis.

In Clean Architecture, business orchestration must live inside use cases.

## Decision
Create the package:

internal/app/usecase


And implement the first use case:

- `AnalyzePDFUseCase`

Structure:
- Receives an input DTO (`AnalyzePDFInput`)
- Calls a port (`PDFAnalyzerPort`)
- Returns an output DTO (`AnalyzePDFOutput`)

Use cases must:
- contain no HTTP logic,
- contain no PDF library details,
- depend only on ports and domain types.

## Consequences

### Positive
- Clear orchestration layer.
- Easy to extend (future features: metadata extraction, chunking, text embeddings).
- Enables isolated testing of application logic.

### Negative
- Requires new constructor wiring.
- Requires handler adaptation.

## Alternatives
A) Continue triggering analysis from handlers  
Rejected – violates business separation and harms testability.

B) Introduce use cases only after multiple endpoints exist  
Rejected – harder migration later; best to introduce structure early.
