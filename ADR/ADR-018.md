# ADR-018 — Unit Testing Use Cases via Mocked Ports

## Status
Accepted

## Context
Clean Architecture requires that the application layer (use cases)
be isolated from infrastructure concerns.  
The AnalyzePDFUseCase depends only on the PDFAnalyzerPort interface.

To validate the architecture and guarantee correctness, we must test the
use case **without**:

- the real PDF analyzer,
- the filesystem,
- Gin,
- external libraries,
- domain parsing implementations.

This means testing the behavior of the use case *using a mock implementation*
of the port.

## Decision
Create a mock implementing PDFAnalyzerPort under:

internal/app/port/mock/


This mock will:
- return deterministic domain objects,
- simulate failures,
- allow assertion of use case behavior.

Unit tests will cover:
- happy path,
- invalid DTO,
- domain validation error,
- port failure.

## Consequences

### Positive
- Verifies the architecture is correctly decoupled.
- Ensures use cases work independently of infrastructure.
- Allows fast, reliable unit tests.
- Enables TDD workflows for new features.

### Negative
- Requires mock maintenance if port signatures change.

## Alternatives

### A) Use the real analyzer in tests  
Rejected — couples tests to infrastructure and violates layers.

### B) Use a mocking framework  
Rejected — overkill for Go; simple hand-written mocks are more readable.
